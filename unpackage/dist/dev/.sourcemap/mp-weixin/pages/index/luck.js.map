{"version":3,"sources":["uni-app:///main.js",null,"webpack:////Users/pengdongjiang/Documents/code/sale/uniapp/pages/index/luck.vue?4341","webpack:////Users/pengdongjiang/Documents/code/sale/uniapp/pages/index/luck.vue?448b","webpack:////Users/pengdongjiang/Documents/code/sale/uniapp/pages/index/luck.vue?0d39","uni-app:///pages/index/luck.vue"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page"],"mappings":";;;;;;;;;;kDAAA;;;AAGA;AACA,0F,8FAHA;AACAA,EAAE,CAACC,iCAAH,GAAuCC,mBAAvC,CAGAC,UAAU,CAACC,aAAD,CAAV,C;;;;;;;;;;;;;ACLA;AAAA;AAAA;AAAA;AAAA;AAAiH;AACjH;AACwD;AACL;;;AAGnD;AACmN;AACnN,gBAAgB,iNAAU;AAC1B,EAAE,0EAAM;AACR,EAAE,+EAAM;AACR,EAAE,wFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,mFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,4SAEN;AACP,KAAK;AACL;AACA,aAAa,+PAEN;AACP,KAAK;AACL;AACA,aAAa,+VAEN;AACP;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AChDA;AAAA;AAAA;AAAA;AAAi1B,CAAgB,kyBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC0Br2B,qG;AACA;AACA,cADA;AAEA;AACA,gCADA,EAFA;;AAKA,MALA,kBAKA;AACA;AACA,gBADA;AAEA;AACA,iBAHA;;AAKA;AACA;AACA;AACA,wBAFA;AAGA;AACA,uBAJA,EANA;;;AAaA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,mBArBA;AAsBA;AACA,mBAvBA;AAwBA;AACA,oBAzBA;;AA2BA;AACA,qBA5BA;;AA8BA;AACA;AACA,uBAhCA;AAiCA;AACA,uBAlCA;AAmCA;AACA,wBApCA;;AAsCA;AACA;AACA,mBAxCA;AAyCA;AACA,gBA1CA;AA2CA;AACA,iBA5CA;AA6CA;AACA,mBA9CA;;AAgDA,GAtDA;AAuDA;AACA,WADA,qBACA;AACA;AACA,KAHA,EAvDA;;AA4DA;AACA;AACA,sBAFA,8BAEA,KAFA,EAEA;AACA,gDADA;AAEA;AACA,mCADA;AAEA,4BAFA;AAGA,8BAHA,IAFA;;;;AASA;AACA;AACA,+CADA;AAEA,kCAFA;AAGA,0CAHA,EADA,CATA,SASA,GATA;;;AAgBA,oBAhBA,GAgBA,QAhBA;AAiBA,4BAjBA;AAkBA;AACA,qCADA;AAEA,mCAFA,IAlBA;;;;AAwBA;AACA;AACA,uCADA;AAEA,mCAFA;;AAIA,mCA7BA;AA8BA,KAhCA;AAiCA;AACA,oBAlCA,8BAkCA;AACA;AACA;;AAEA;AACA;AACA,KAxCA;AAyCA;AACA,gBA1CA,0BA0CA;AACA;AACA,mCADA;;;AAIA;AALA,0CAMA,+BANA,QAMA,GANA;AAOA;AACA;AACA;AACA;AACA,2CADA;AAEA,qCAFA;;AAIA;AACA,oBAfA,GAeA,aAfA;AAgBA;AACA;AACA;AACA,uCADA;AAEA,qCAFA;;AAIA;AACA;AACA,yBAxBA,GAwBA;AACA;AACA,oCADA;AAEA,yCAFA;AAGA,wCAHA;AAIA,iDAJA;AAKA,mCALA;;AAOA,iBARA,CAxBA;AAiCA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,sCAHA,sBAGA,qBAHA;AAIA;;AAEA;AACA;AACA;AACA,iBArDA;AAsDA,KAhGA;AAiGA;AACA;AACA;AACA,0BApGA,oCAoGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBADA;AAEA,gCAFA,EADA;;;AAMA,KApHA;AAqHA;AACA,mBAtHA,6BAsHA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAnJA;AAoJA;AACA,kBArJA,4BAqJA;AACA;AACA;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA;AACA,KA7JA;AA8JA;AACA,sBA/JA,gCA+JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAJA;AAKA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAFA,MAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCADA;AAEA,8BAFA;;AAIA;AACA,aAPA;AAQA;AACA;AACA;AACA;AACA;AACA,SA9BA,MA8BA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,KArOA;AAsOA;AACA;AACA,uBAxOA,iCAwOA;AACA;AACA;AACA,uCADA;AAEA,kCAFA;AAGA,qDAHA,EADA,CADA,SACA,GADA;;;AAQA,oBARA,GAQA,QARA;AASA,4BATA;AAUA;AACA;AACA,qCADA;AAEA;AACA;AACA;AAJA;AAMA,wCAjBA;;;AAoBA,uBApBA,GAoBA,YApBA;AAqBA,oBArBA,sBAqBA,gBArBA;AAsBA;AACA,iBAvBA,GAuBA,CAvBA,eAuBA,eAvBA;AAwBA,oBAxBA,GAwBA,OAxBA;AAyBA,wCAzBA;AA0BA;AACA,sCA3BA,6CAuBA,GAvBA;;;;AA+BA;AACA;AACA;AACA;AACA,iBAnCA;AAoCA,KA5QA;AA6QA;AACA,iBA9QA,2BA8QA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,OAFA,MAEA;AACA;AACA;AACA;AACA;AACA,SAHA,MAGA;AACA;AACA;AACA;;AAEA;AACA,2BADA;AAEA,yBAFA;AAGA;AACA;AACA,SALA;;AAOA;AACA,KAzSA;AA0SA;AACA,oBA3SA,4BA2SA,GA3SA,EA2SA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,wBADA;AAEA,oBAFA;AAGA,sBAHA;;AAKA,OATA,EASA,EATA;AAUA,KA/TA,EA5DA;;AA6XA,QA7XA,kBA6XA,MA7XA,EA6XA;AACA;AACA;AACA,sBADA;;AAGA;AACA;AACA,GApYA;AAqYA,UArYA,sBAqYA;AACA;AACA,GAvYA;AAwYA,SAxYA,qBAwYA;;AAEA,GA1YA;AA2YA,SA3YA,qBA2YA;AACA;AACA,GA7YA,E","file":"pages/index/luck.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/index/luck.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./luck.vue?vue&type=template&id=3e564df2&\"\nvar renderjs\nimport script from \"./luck.vue?vue&type=script&lang=js&\"\nexport * from \"./luck.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/index/luck.vue\"\nexport default component.exports","export * from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./luck.vue?vue&type=template&id=3e564df2&\"","var components\ntry {\n  components = {\n    almostLottery: function() {\n      return import(\n        /* webpackChunkName: \"uni_modules/almost-lottery/components/almost-lottery/almost-lottery\" */ \"@/uni_modules/almost-lottery/components/almost-lottery/almost-lottery.vue\"\n      )\n    },\n    uniPopup: function() {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-popup/components/uni-popup/uni-popup\" */ \"@/uni_modules/uni-popup/components/uni-popup/uni-popup.vue\"\n      )\n    },\n    uniPopupDialog: function() {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog\" */ \"@/uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog.vue\"\n      )\n    }\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  if (!_vm._isMounted) {\n    _vm.e0 = function($event) {\n      _vm.prizeIndex = -1\n    }\n  }\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./luck.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./luck.vue?vue&type=script&lang=js&\"","<template>\n\t<view>\n\t\t<almost-lottery\n\t\t\t:lottery-size=\"lotteryConfig.lotterySize\"\n\t\t\t:action-size=\"lotteryConfig.actionSize\"\n\t\t\t:ring-count=\"2\"\n\t\t\t:duration=\"1\"\n\t\t\t:img-circled=\"true\"\n\t\t\t:canvasCached=\"true\"\n\t\t\t:prize-list=\"prizeList\"\n\t\t\t:prize-index=\"prizeIndex\"\n\t\t\t@reset-index=\"prizeIndex = -1\"\n\t\t\t@draw-start=\"handleDrawStart\"\n\t\t\t@draw-end=\"handleDrawEnd\"\n\t\t\t@finish=\"handleDrawFinish\"\n\t\t\tv-if=\"prizeList.length\"\n\t\t/>\n    <uni-popup ref=\"inputDialog\" type=\"dialog\">\n      <uni-popup-dialog ref=\"phoneInput\" type=\"number\" mode=\"input\" title=\"输入手机号领取奖品\" value=\"\"\n        placeholder=\"请输入手机号\" @confirm=\"dialogPhoneConfirm\" :before-close=\"true\"></uni-popup-dialog>\n    </uni-popup>\n\t</view>\n</template>\n\n<script>\n  import AlmostLottery from '@/uni_modules/almost-lottery/components/almost-lottery/almost-lottery.vue'\n\timport { clearCacheFile, clearStore } from '@/uni_modules/almost-lottery/utils/almost-utils.js'\n  export default {\n    name: 'Home',\n    components: {\n      AlmostLottery\n    },\n    data () {\n      return {\n        luck_id: 0,\n        // 开启调试模式\n        isDev: true,\n        \n        // 以下是转盘配置相关数据\n        lotteryConfig: {\n          // 抽奖转盘的整体尺寸，单位rpx\n          lotterySize: 600,\n          // 抽奖按钮的尺寸，单位rpx\n          actionSize: 200\n        },\n        \n        // 以下是转盘 UI 配置\n        // 转盘外环图，如有需要，请参考替换为自己的设计稿\n        // lotteryBg: require('@/static/lottery-bg.png'),\n        // 抽奖按钮图\n        // actionBg: require('@/static/action-bg.png'),\n        \n        // 以下是奖品配置数据\n        // 奖品数据\n        prizeList: [],\n\t\t\t\t// 奖品是否设有库存\n\t\t\t\tonStock: true,\n        // 中奖下标\n        prizeIndex: -1,\n        \n        // 是否正在抽奖中，避免重复触发\n        prizeing: false,\n        \n        // 以下为中奖概率有关数据\n        // 是否由前端控制概率，默认不开启，强烈建议由后端控制\n        onFrontend: false,\n        // 权重随机数的最大值\n        prizeWeightMax: 0,\n        // 权重数组\n        prizeWeightArr: [],\n        \n        // 以下为业务需求有关示例数据\n        // 金币余额\n        goldCoin: 600,\n        // 当日免费抽奖次数余额\n        freeNum: 3,\n        // 每次消耗的金币数\n        goldNum: 20,\n        // 每天免费抽奖次数\n        freeNumDay: 3\n      }\n    },\n    computed: {\n      isApple () {\n        return uni.getSystemInfoSync().platform === 'ios'\n      }\n    },\n    methods: {\n      // 提交中奖手机号\n      async dialogPhoneConfirm(value) {\n        if(!this.$validator.PhoneNum(value)){\n          uni.showToast({\n            title: \"手机号格式不正确\",\n          \tmask: true,\n          \ticon: 'none'\n          });\n          return\n        }\n        let res = await this.$request.send(\n          {\n            url:'luck/updateUserPhone',\n            method:'POST',\n            data:{phone:value}\n          } \n        );\n        let data = res.data\n        if(!data.success) {\n\t\t\t\t\tuni.showModal({\n\t\t\t\t\t\ttitle: data.message,\n            showCancel: false,\n\t\t\t\t\t})\n          return\n        }\n        this.$refs.inputDialog.close();\n        uni.showModal({\n          title: \"谢谢，你的奖品会快马加鞭\",\n          showCancel: false,\n        })\n        console.log(value);\n      },\n      // 重新生成\n      handleInitCanvas () {\n\t\t\t\tclearCacheFile()\n        clearStore()\n        \n        this.prizeList = []\n        this.getPrizeList()\n      },\n      // 获取奖品列表\n      async getPrizeList () {\n        uni.showLoading({\n          title: '奖品准备中...'\n        })\n\t\t\t\t\n        // 等待接口返回的数据进一步处理\n        let res = await this.requestApiGetPrizeList()\n        console.log('res:',res);\n        if(!res.data.success) {\n          uni.hideLoading()\n\t\t\t\t\tuni.showModal({\n\t\t\t\t\t\ttitle: res.data.message,\n            showCancel: false,\n\t\t\t\t\t})\n        }\n        const data = res.data.data;\n        if(!data.success) {\n          uni.hideLoading()\n\t\t\t\t\tuni.showModal({\n\t\t\t\t\t\ttitle: data.message,\n            showCancel: false,\n\t\t\t\t\t})\n        }\n        this.isNoData = (data.length <= 0);\n        const data_list = data.items.map((item) => {\n          return {\n            prizeId: item.id,\n            prizeName: item.title,\n            prizeImage: item.img,\n            prizeWeight: item.probability,\n            prizeStock: 100,\n          };\n        });\n        if (data_list.length) {\n          this.prizeList = data_list\n          console.log('已获取到奖品列表数据，开始绘制抽奖转盘')\n          \n          // 计算开始绘制的时间\n          if (console.time) {\n            console.time('绘制转盘用时')\n          }\n          \n          // 如果开启了前端控制概率\n          // 得出权重的最大值并生成权重数组\n          if (this.onFrontend) {\n            // 生成权重数组并排序取得最大值\n            this.prizeWeightArr = this.prizeList.map((item) => item.prizeWeight)\n            let prizeWeightArrSort = [...this.prizeWeightArr]\n            prizeWeightArrSort.sort((a, b) => b - a)\n            \n            // 开放自定义权重最大值，没有自定义则取权重数组中的最大值\n            this.prizeWeightMax = this.prizeWeightMax > 0 ? this.prizeWeightMax : prizeWeightArrSort[0]\n          }\n        }\n      },\n\t\t\t// 模拟请求 获取奖品列表 接口，\n      // 注意这里返回的是一个 Promise\n      // 大哥，这里只是模拟，别告诉我你不会对接自己的接口\n\t\t\trequestApiGetPrizeList () {\n        // return {\n\t\t\t\t// \t\t\tok: true,\n\t\t\t\t// \t\t\tdata: [\n\t\t\t\t// \t\t\t\t{ prizeId: 3, prizeName: '5元话费', prizeStock: 1, prizeWeight: 80 },\n\t\t\t\t// \t\t\t\t{ prizeId: 6, prizeName: '0.2元现金', prizeStock: 8, prizeWeight: 120 },\n\t\t\t\t// \t\t\t\t{ prizeId: 7, prizeName: '谢谢参与', prizeStock: 100, prizeWeight: 10000 },\n\t\t\t\t// \t\t\t\t{ prizeId: 8, prizeName: '100金币', prizeStock: 100, prizeWeight: 3000 }\n\t\t\t\t// \t\t\t]\n\t\t\t\t// \t\t};\n        return this.$request.send(\n          {\n            url:'luck/get',\n            data:this.requestParams\n          }\n        );\n\t\t\t},\n      // 本次抽奖开始\n      handleDrawStart () {\n        console.log('触发抽奖按钮')\n        if (this.prizeing) return\n        this.prizeing = true\n        \n        // 还有免费数次或者剩余金币足够抽一次\n        // if (this.freeNum > 0 || this.goldCoin >= this.goldNum) {\n        \n        //   // 更新免费次数或金币余额\n        //   if (this.freeNum > 0) {\n        //     this.freeNum--\n        //   } else if (this.goldCoin >= this.goldNum) {\n        //     this.goldCoin -= this.goldNum\n        //   }\n          \n          this.tryLotteryDraw()\n        // } else {\n        //   uni.showModal({\n        //     title: '金币不足',\n        //     content: '是否前往赚取金币？',\n        //     success: (res) => {\n        //       // 这里需要根据业务需求处理，一般情况下会引导用户前往赚取金币的页面\n        //       console.log('金币不足', res)\n        //     },\n        //     complete: () => {\n        //       this.prizeing = false\n        //     }\n        //   })\n        // }\n      },\n      // 尝试发起抽奖\n      tryLotteryDraw () {\n        console.log('旋转开始，获取中奖下标......')\n        // 判断是否由前端控制概率\n        if (this.onFrontend) {\n          this.localGetPrizeIndex()\n        } else {\n          this.remoteGetPrizeIndex()\n        }\n      },\n      // 本地获取中奖下标\n      localGetPrizeIndex () {\n        console.warn('###当前处于前端控制中奖概率，安全起见，强烈建议由后端控制###')\n        // 前端控制概率的情况下，需要拿到最接近随机权重且大于随机权重的值\n        // 后端控制概率的情况下，通常会直接返回 prizeId\n        if (!this.prizeWeightMax || !this.prizeWeightArr.length) {\n        \tconsole.warn('###当前已开启前端控制中奖概率，但是奖品数据列表中的 prizeWeight 参数似乎配置不正确###')\n        \treturn\n        }\n        console.log('当前权重最大值为 =>', this.prizeWeightMax)\n        \n        // 注意这里使用了 Math.ceil，如果某个权重的值为 0，则始终无法中奖\n        let randomWeight = Math.ceil(Math.random() * this.prizeWeightMax)\n        console.log('本次权重随机数 =>', randomWeight)\n        \n        // 生成大于等于随机权重的数组\n        let tempMaxArrs = []\n        this.prizeList.forEach((item) => {\n          if (item.prizeWeight >= randomWeight) {\n            tempMaxArrs.push(item.prizeWeight)\n          }\n        })\n        console.log('tempMaxArrs', tempMaxArrs)\n        \n        // 如果大于随机权重的数组有值，先对这个数组排序然后取值\n        // 反之新建一个临时的包含所有权重的已排序数组，然后取值\n        let tempMaxArrsLen = tempMaxArrs.length\n        if (tempMaxArrsLen) {\n          tempMaxArrs.sort((a, b) => a - b)\n          // 取值时，如果存在多个值，分两种情况\n          if (tempMaxArrsLen > 1) {\n            // 检查是否存在重复的值\n            let sameCount = 0\n            for (let i = 0; i < tempMaxArrs.length; i++) {\n              if (tempMaxArrs[i] === tempMaxArrs[0]) {\n                sameCount++\n              }\n            }\n            \n            // 值不相等的情况下取最接近的值，也就是第1个值\n            if (sameCount === 1) {\n              this.prizeIndex = this.prizeWeightArr.indexOf(tempMaxArrs[0])\n            } else {\n              // 存在值相等时，随机取值，当然这里你可以自己决定是否随机取值\n              let sameWeight = tempMaxArrs[0]\n              let sameWeightArr = []\n              let sameWeightItem = {}\n              this.prizeWeightArr.forEach((item, index) => {\n                if (item === sameWeight) {\n                  sameWeightArr.push({\n                    prizeWeight: item,\n                    index\n                  })\n                }\n              })\n              console.log('sameWeightArr', sameWeightArr)\n              sameWeightItem = sameWeightArr[Math.floor(Math.random() * sameWeightArr.length)]\n              console.log('sameWeightItem', sameWeightItem)\n              this.prizeIndex = sameWeightItem.index\n            }\n          } else {\n            this.prizeIndex = this.prizeWeightArr.indexOf(tempMaxArrs[0])\n          }\n        }\n        \n        console.log('本次抽中奖品 =>', this.prizeList[this.prizeIndex].prizeName)\n        \n        // 如果奖品设有库存\n        if (this.onStock) {\n          console.log('本次奖品库存 =>', this.prizeList[this.prizeIndex].prizeStock)\n        }\n      },\n      // 远程请求接口获取中奖下标\n      // 大哥，这里只是模拟，别告诉我你不会对接自己的接口\n      async remoteGetPrizeIndex () {\n        let res =  await this.$request.send(\n          {\n            url:'luck/addDraw',\n            method:'POST',\n            data:{luck_id:this.luck_id}\n          }\n        );\n        let data = res.data\n        if(!data.success) {\n          uni.hideLoading()\n\t\t\t\t\tuni.showModal({\n\t\t\t\t\t\ttitle: data.message,\n            showCancel: false,\n            // mask: true,\n            // icon: 'none'\n\t\t\t\t\t})\n          this.prizeing = false;\n          return\n        }\n        let prizeId = data.data.id\n        let list = [...this.prizeList]\n        // 拿到后端返回的 prizeId 后，开始循环比对得出那个中奖的数据\n        for (let i = 0; i < list.length; i++) {\n          let item = list[i]\n          if (item.prizeId === prizeId) {\n            // 中奖下标\n            this.prizeIndex = i\n            break\n          }\n        }\n        console.log('本次抽中奖品 =>', this.prizeList[this.prizeIndex].prizeName)\n        // 如果奖品设有库存\n        if (this.onStock) {\n          console.log('本次奖品库存 =>', this.prizeList[this.prizeIndex].prizeStock)\n        }\n      },\n      // 本次抽奖结束\n      handleDrawEnd () {\n        console.log('旋转结束，执行拿到结果后到逻辑')\n        \n        // 旋转结束后，开始处理拿到结果后的逻辑\n        let prizeName = this.prizeList[this.prizeIndex].prizeName\n        let tipContent = ''\n\t\t\t\t\n\t\t\t\tif (prizeName === '谢谢参与') {\n          tipContent = '很遗憾，没有中奖，请再接再厉！'\n\t\t\t\t} else {\n          // 如果奖品设有库存\n          if (this.onStock) {\n            let prizeStock = this.prizeList[this.prizeIndex].prizeStock\n            tipContent = prizeStock ? `恭喜您，获得 ${prizeName}` : `很抱歉，您来晚了，当前奖品 ${prizeName} 已无库存`\n          } else {\n            tipContent = `恭喜您，获得 ${prizeName} ！`\n          }\n        }\n        \n        uni.showModal({\n          content: tipContent,\n          showCancel: false,\n          complete: () => {\n            this.prizeing = false\n          }\n        })\n        this.$refs.inputDialog.open()\n      },\n      // 抽奖转盘绘制完成\n      handleDrawFinish (res) {\n        console.log('抽奖转盘绘制完成', res)\n        \n        if (res.ok) {\n          // 计算结束绘制的时间\n          if (console.timeEnd) {\n            console.timeEnd('绘制转盘用时')\n          }\n        }\n\t\t\t\t\n        let stoTimer = setTimeout(() => {\n          stoTimer = null\n          \n          uni.hideLoading()\n          uni.showToast({\n            title: res.msg,\n          \tmask: true,\n          \ticon: 'none'\n          })\n        }, 50)\n      },\n    },\n    onLoad (option) {\n      this.luck_id = option.luck_id\n      this.requestParams = {\n        id: this.luck_id,\n      };\n      this.prizeList = []\n      this.getPrizeList()\n    },\n    onUnload () {\n      uni.hideLoading()\n    },\n    created() {\n\n    },\n    onReady() {\n      // this.loadData();\n    },\n  }\n</script>\n\n<style>\n</style>\n"],"sourceRoot":""}